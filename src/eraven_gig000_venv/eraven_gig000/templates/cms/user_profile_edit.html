<!-- cms/templates/cms/user_profile_edit.html -->

{% extends "base.html" %}
{% load static %}
{% block title %}Edit Profile - ERaven Gigs{% endblock %}

{% block content %}
<div class="container mt-4 profile-edit-page">
    <h1 class="mb-4 text-center text-primary">Edit Profile</h1>

    <!-- Navbar with Tabs -->
    <ul class="nav nav-tabs mb-4" id="editProfileTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="personal-data-tab" data-bs-toggle="tab" data-bs-target="#personal-data" type="button" role="tab" aria-controls="personal-data" aria-selected="true">
                <i class="fas fa-user-edit me-1"></i> Personal Data
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab" aria-controls="security" aria-selected="false">
                <i class="fas fa-lock me-1"></i> Security
            </button>
        </li>
    </ul>

    <div class="tab-content" id="editProfileTabContent">
        <!-- Personal Data Tab -->
        <div class="tab-pane fade show active" id="personal-data" role="tabpanel" aria-labelledby="personal-data-tab">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Edit Personal Data</h3>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <!-- Profile Picture Section -->
                        <div class="text-center mb-4">
                            {% if profile_form.profile_picture.value %}
                                <img src="{{ profile_form.profile_picture.value.url }}" alt="Profile Picture" class="profile-pic-lg mb-3">
                            {% else %}
                                <img src="{% static 'images/default_profile.png' %}" alt="Default Profile Picture" class="profile-pic-lg mb-3">
                            {% endif %}
                            <div class="mb-3">
                                {{ profile_form.profile_picture.label_tag }}
                                {{ profile_form.profile_picture }}
                                {% if profile_form.profile_picture.errors %}
                                    <div class="text-danger">{{ profile_form.profile_picture.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ profile_form.first_name.label_tag }}
                                {{ profile_form.first_name }}
                                {% if profile_form.first_name.errors %}
                                    <div class="text-danger">{{ profile_form.first_name.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                {{ profile_form.last_name.label_tag }}
                                {{ profile_form.last_name }}
                                {% if profile_form.last_name.errors %}
                                    <div class="text-danger">{{ profile_form.last_name.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="mb-3">
                            {{ profile_form.email.label_tag }}
                            {{ profile_form.email }}
                            {% if profile_form.email.errors %}
                                <div class="text-danger">{{ profile_form.email.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="phoneNumber" class="form-label"><strong>Phone Number</strong></label>
                                {{ profile_form.phone_number }}
                                {% if profile_form.phone_number.errors %}
                                    <div class="text-danger">{{ profile_form.phone_number.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="address" class="form-label"><strong>Address</strong></label>
                                {{ profile_form.address }}
                                {% if profile_form.address.errors %}
                                    <div class="text-danger">{{ profile_form.address.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="dateOfBirth" class="form-label"><strong>Date of Birth</strong></label>
                                {{ profile_form.date_of_birth }}
                                {% if profile_form.date_of_birth.errors %}
                                    <div class="text-danger">{{ profile_form.date_of_birth.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="role" class="form-label"><strong>Role</strong></label>
                                <input type="text" class="form-control" id="role" value="{% if user.role %}{{ user.role.name }}{% else %}No Role Assigned{% endif %}" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="level" class="form-label"><strong>Level</strong></label>
                                <input type="text" class="form-control" id="level" value="{{ user.level }}" readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="bundles" class="form-label"><strong>Purchased Products (Bundles)</strong></label>
                                <select class="form-select" id="bundles" name="bundles" multiple disabled>
                                    {% for bundle in user.bundles.all %}
                                        <option selected>{{ bundle.title }}</option>
                                    {% empty %}
                                        <option>No Bundles Purchased</option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">Purchased bundles cannot be edited here.</small>
                            </div>
                        </div>
                        <button type="submit" name="save_changes" class="btn btn-primary mt-3">Save Changes</button>
                        <a href="{% url 'user_profile' %}" class="btn btn-secondary mt-3">Cancel</a>
                    </form>
                </div>
            </div>
        </div>

        <!-- Security Tab -->
        <div class="tab-pane fade" id="security" role="tabpanel" aria-labelledby="security-tab">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h3 class="mb-0">Security Settings</h3>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            {{ security_form.current_password.label_tag }}
                            {{ security_form.current_password }}
                            {% if security_form.current_password.errors %}
                                <div class="text-danger">{{ security_form.current_password.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="mb-3">
                            {{ security_form.new_password.label_tag }}
                            {{ security_form.new_password }}
                            {% if security_form.new_password.errors %}
                                <div class="text-danger">{{ security_form.new_password.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="mb-3">
                            {{ security_form.confirm_password.label_tag }}
                            {{ security_form.confirm_password }}
                            {% if security_form.confirm_password.errors %}
                                <div class="text-danger">{{ security_form.confirm_password.errors }}</div>
                            {% endif %}
                        </div>
                        <button type="submit" name="update_password" class="btn btn-primary mt-3">Update Password</button>
                        <a href="{% url 'user_profile' %}" class="btn btn-secondary mt-3">Cancel</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include Font Awesome for Icons -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<!-- Include Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Link to External CSS -->
<link href="{% static 'css/user_profile.css' %}" rel="stylesheet" />
{% endblock %}
